!function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,l=null;function onInputFieldClick(e,t){t.stopPropagation(),function showDom(e,t){if(i===e)return;i&&i!==e&&onBlur();i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp));switch(n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}(e,t)}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("textInput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation()}function onKeyUp(e){e.preventDefault(),e.stopPropagation(),13===e.keyCode&&n.blur()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const l=(e[2].x-e[0].x)/o-20,s=(e[2].y-e[0].y)/o;n.style.width=l+"px",n.style.height=s+"px",n.style.fontSize=Math.round(.5*s)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("textInput:clicked",onInputFieldClick),l=null}e?l=setTimeout(onIosResizeTimeout,2100):t.on("textInput:clicked",onInputFieldClick),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!l&&(t.off("textInput:clicked",onInputFieldClick),l=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}();var MouseLocker=pc.createScript("mouseLocker");MouseLocker.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)}),this)},MouseLocker.prototype.onMouseDown=function(o){this.app.mouse.enablePointerLock()};var NetworkManager=pc.createScript("networkManager");NetworkManager.attributes.add("selfMaterial",{type:"asset",title:"Self Player Material"}),NetworkManager.prototype.initialize=async function(){console.log("Connecting"),this.app.colyseus=new Colyseus.Client("ws://www.jerrymc.cn:4819"),console.log("Joining room"),this.room=await this.app.colyseus.joinOrCreate("my_room"),this.playerEntities={},this.currentPlayerEntity=void 0,this.room.state.players.onAdd(((e,t)=>{console.log("A player has joined! Their unique session id is",t),console.log("New player data",e);const o=this.app.root.findByName("Player"),s=o.clone();s.enabled=!0,s.setPosition(e.x,e.y,e.z),o.parent.addChild(s),this.playerEntities[t]=s,e.onChange((()=>{this.playerEntities[t].setPosition(e.x,e.y,e.z)})),this.room.sessionId===t&&(this.currentPlayerEntity=this.playerEntities[t],s.script.playerMovement.enabled=!0,console.log(this.selfMaterial),console.log(this.selfMaterial.name),s.model.materialAsset=this.app.assets.find(this.selfMaterial.name,"material"))})),this.room.state.players.onRemove(((e,t)=>{this.playerEntities[t].destroy(),delete this.playerEntities[t]})),this.room.onMessage("force",(({sessionId:e,force:t})=>{console.log("force",e,t),this.room.sessionId!=e&&this.playerEntities[e].rigidbody.applyImpulse(t.x,t.y,t.z)})),NetworkManager.prototype.updatePosition=function(e,t,o){this.room.send("updatePosition",{x:e,y:t,z:o})},NetworkManager.prototype.updateForce=function(e,t,o){this.room.send("updateForce",{x:e,y:t,z:o})}};var PlayerMovement=pc.createScript("playerMovement"),time=0;PlayerMovement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),PlayerMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.networkManager=this.app.root.findByName("NetworkManager").script.networkManager},PlayerMovement.prototype.update=function(e){var t=0,i=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(i=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(i+=this.speed),this.force.x=t,this.force.z=i,this.force.length()){var s=Math.cos(.25*-Math.PI),r=Math.sin(.25*-Math.PI);this.force.set(this.force.x*s-this.force.z*r,0,this.force.z*s+this.force.x*r),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}if(this.entity.rigidbody.applyImpulse(this.force),time+=1e3*e,Math.floor(time)%20==0){var o=this.entity.getPosition();this.networkManager.updatePosition(o.x,o.y,o.z),this.networkManager.updateForce(t,0,i)}};var TextInput=pc.createScript("textInput");TextInput.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),TextInput.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),TextInput.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),TextInput.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),TextInput.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),TextInput.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),TextInput.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},TextInput.prototype.setEvents=function(t){this.entity[t]("textInput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this)},TextInput.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},TextInput.prototype._onClick=function(t){this.app.fire("textInput:clicked",this,t)};var NetworkChecker=pc.createScript("networkChecker");NetworkChecker.attributes.add("onlineText",{type:"string",title:"Online Text"}),NetworkChecker.attributes.add("onlineColor",{type:"rgb",title:"Online Text Color"}),NetworkChecker.attributes.add("errorText",{type:"string",title:"Error Text"}),NetworkChecker.attributes.add("errorColor",{type:"rgb",title:"Online Text Color"}),NetworkChecker.attributes.add("activeBtn",{type:"entity",title:"Activate Button"}),NetworkChecker.prototype.initialize=async function(){this.activeBtn.button.active=!1;try{200==(await fetch("http://www.jerrymc.cn:4819/ping")).status?this.serverOnline():this.serverError()}catch(t){t&&this.serverError()}},NetworkChecker.prototype.serverOnline=function(){this.entity.element.text=this.onlineText,this.entity.element.color=this.onlineColor,this.activeBtn.button.active=!0},NetworkChecker.prototype.serverError=function(){this.entity.element.text=this.errorText,this.entity.element.color=this.errorColor};var JoinHandler=pc.createScript("joinHandler");JoinHandler.attributes.add("nameEntity",{type:"entity",title:"Name Text Entity"}),JoinHandler.prototype.initialize=function(){this.entity.button.on("click",this.join,this)},JoinHandler.prototype.join=function(){var t=this.nameEntity.element.text.trim();if(0==t.length||"Enter your name"==t)return alert("Name invalid");console.log("Joining room with name",t);var n=this.app.scenes.find("Play");this.app.root.findByName("menu").enabled=!1,this.app.scenes.changeScene(n.url)};