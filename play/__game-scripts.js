var Config=pc.createScript("config");Config.attributes.add("serverUrl",{type:"string"}),Config.prototype.getConfig=function(t){return this[t]};!function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,s=null;function onInputFieldClick(e,t){t.stopPropagation(),function showDom(e,t){if(i===e)return;i&&i!==e&&onBlur();i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp));switch(n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}(e,t)}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("textInput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation()}function onKeyUp(e){e.preventDefault(),e.stopPropagation(),13===e.keyCode&&n.blur()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const s=(e[2].x-e[0].x)/o-20,l=(e[2].y-e[0].y)/o;n.style.width=s+"px",n.style.height=l+"px",n.style.fontSize=Math.round(.5*l)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("textInput:clicked",onInputFieldClick),s=null}e?s=setTimeout(onIosResizeTimeout,2100):t.on("textInput:clicked",onInputFieldClick),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!s&&(t.off("textInput:clicked",onInputFieldClick),s=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}(),function(){const e={},t={},n={buttons:{isPressed:function(e){return!!t[e]},wasPressed:function(n){const o=t[n],i=e[n];return void 0!==t[n]&&(!i&&o)},wasReleased:function(n){const o=t[n],i=e[n];return void 0!==t[n]&&(i&&!o)},wasTapped:function(t){if(this.wasReleased(t)){return Date.now()-e[t]<=200}return!1}},sticks:{}};n.buttonStates=t;pc.Application.getApplication().on("update",(()=>{for(const n of Object.keys(t)){const o=t[n];e[n]=o}})),window.touchJoypad=n}();pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var MouseLocker=pc.createScript("mouseLocker");MouseLocker.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)}),this)},MouseLocker.prototype.onMouseDown=function(o){};var NetworkManager=pc.createScript("networkManager");NetworkManager.attributes.add("selfMaterial",{type:"asset",title:"Self Player Material"}),NetworkManager.prototype.initialize=async function(){console.log("Connecting"),this.app.colyseus=new Colyseus.Client("ws://"+this.app.root.findByName("Config").script.config.getConfig("serverUrl")),console.log("Joining room"),this.room=await this.app.colyseus.joinOrCreate("my_room"),this.playerEntities={},this.currentPlayerEntity=void 0,this.room.state.players.onAdd(((e,t)=>{console.log("A player has joined! Their unique session id is",t),console.log("New player data",e);const i=this.app.root.findByName("Player"),o=i.clone();o.enabled=!0,o.setPosition(e.x,e.y,e.z),i.parent.addChild(o),this.playerEntities[t]=o,e.onChange((()=>{this.playerEntities[t].setPosition(e.x,e.y,e.z)})),this.room.sessionId===t&&(this.currentPlayerEntity=this.playerEntities[t],o.script.playerMovement.enabled=!0,o.model.materialAsset=this.app.assets.find(this.selfMaterial.name,"material"))})),this.room.onStateChange((({alive:e})=>{this.app.fire("alive:change",this.room.state.alive)})),this.room.onLeave((e=>{this.app.root.findByName("Play Screen").enabled=!1,this.app.root.findByName("Die Screen").enabled=!1,this.app.root.findByName("Spec Screen").enabled=!1,this.app.root.findByName("Disconnect Screen").enabled=!0;var t=this.app.root.findByTag("disconnectReason")[0];switch(e){case 4e3:t.element.text="Room closed by server";break;case 4001:t.element.text="No alive players"}})),this.room.state.players.onRemove(((e,t)=>{this.playerEntities[t].destroy(),delete this.playerEntities[t]})),this.room.onMessage("force",(({sessionId:e,force:t})=>{this.room.sessionId!=e&&this.playerEntities[e].rigidbody&&this.playerEntities[e].rigidbody.applyImpulse(t.x,t.y,t.z)})),this.room.onMessage("die",(({sessionId:e})=>{console.log("Player die",e),this.playerEntities[e].destroy(),this.room.sessionId==e&&(this.app.root.findByName("Play Screen").enabled=!1,this.app.root.findByName("Die Screen").enabled=!0)})),NetworkManager.prototype.leaveRoom=function(){this.room.leave()},this.app.on("network:position",((e,t,i)=>{this.room.send("updatePosition",{x:e,y:t,z:i})}),this),this.app.on("network:force",((e,t,i)=>{this.room.send("updateForce",{x:e,y:t,z:i})}),this)};var PlayerMovement=pc.createScript("playerMovement"),time=0;PlayerMovement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),PlayerMovement.attributes.add("camera",{type:"entity",title:"Camera"}),PlayerMovement.attributes.add("targetUi",{type:"entity",title:"Target UI"}),PlayerMovement.attributes.add("uiOffset",{type:"vec3",title:"UI Offset"}),PlayerMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.networkManager=this.app.root.findByName("NetworkManager").script.networkManager,this.joystick=this.app.root.findByName("Joystick"),this.cameraOffset=this.camera.getPosition().clone()},PlayerMovement.prototype.update=function(e){var t=0,i=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(i=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(i+=this.speed),this.force.x=t,this.force.z=i,this.force.length()){var s=Math.cos(.25*-Math.PI),a=Math.sin(.25*-Math.PI);this.force.set(this.force.x*s-this.force.z*a,0,this.force.z*s+this.force.x*a),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}if(this.entity.rigidbody.applyImpulse(this.force),time+=1e3*e,Math.floor(time)%20==0){var o=this.entity.getPosition();this.app.fire("network:position",o.x,o.y,o.z),this.app.fire("network:force",t,0,i)}},PlayerMovement.prototype.postUpdate=function(e){this.updateCameraPosition()},PlayerMovement.prototype.updateMePosition=function(){var e=new pc.Vec3;this.camera.camera.worldToScreen(this.entity.getPosition().add(this.uiOffset),e);var t=this.app.graphicsDevice.maxPixelRatio;e.x*=t,e.y*=t;var i=this.app.graphicsDevice;this.targetUi.setPosition(e.x/i.width*2-1,2*(1-e.y/i.height)-1,0)},PlayerMovement.prototype.updateCameraPosition=function(){this.camera.setPosition(this.entity.getPosition().add(this.cameraOffset))};var TextInput=pc.createScript("textInput");TextInput.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),TextInput.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),TextInput.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),TextInput.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),TextInput.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),TextInput.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),TextInput.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},TextInput.prototype.setEvents=function(t){this.entity[t]("textInput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this)},TextInput.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},TextInput.prototype._onClick=function(t){this.app.fire("textInput:clicked",this,t)};var NetworkChecker=pc.createScript("networkChecker");NetworkChecker.attributes.add("onlineText",{type:"string",title:"Online Text"}),NetworkChecker.attributes.add("onlineColor",{type:"rgb",title:"Online Text Color"}),NetworkChecker.attributes.add("errorText",{type:"string",title:"Error Text"}),NetworkChecker.attributes.add("errorColor",{type:"rgb",title:"Online Text Color"}),NetworkChecker.attributes.add("activeBtn",{type:"entity",title:"Activate Button"}),NetworkChecker.prototype.initialize=async function(){this.activeBtn.button.active=!1;try{200==(await fetch("http://www.jerrymc.cn:4819/ping")).status?this.serverOnline():this.serverError()}catch(t){t&&this.serverError()}},NetworkChecker.prototype.serverOnline=function(){this.entity.element.text=this.onlineText,this.entity.element.color=this.onlineColor,this.activeBtn.button.active=!0},NetworkChecker.prototype.serverError=function(){this.entity.element.text=this.errorText,this.entity.element.color=this.errorColor};var JoinHandler=pc.createScript("joinHandler");JoinHandler.attributes.add("nameEntity",{type:"entity",title:"Name Text Entity"}),JoinHandler.prototype.initialize=function(){this.entity.button.on("click",this.join,this)},JoinHandler.prototype.join=function(){var t=this.nameEntity.element.text.trim();if(0==t.length||"Enter your name"==t)return alert("Name invalid");console.log("Joining room with name",t);var n=this.app.scenes.find("Play");this.app.root.findByName("menu").enabled=!1,this.app.scenes.changeScene(n.url)};var UiFromWorld=pc.createScript("uiFromWorld");UiFromWorld.attributes.add("target",{type:"entity"}),UiFromWorld.attributes.add("camera",{type:"entity"}),UiFromWorld.prototype.initialize=function(){},UiFromWorld.prototype.postUpdate=function(t){var i=new pc.Vec3;if(this.camera.camera.worldToScreen(this.target.getPosition(),i),i.z>0){this.entity.enabled=!0;var e=this.app.graphicsDevice.maxPixelRatio;i.x*=e,i.y*=e;var r=this.app.graphicsDevice;this.entity.setPosition(i.x/r.width*2-1,2*(1-i.y/r.height)-1,0)}else this.entity.enabled=!1};var RejoinHandler=pc.createScript("rejoinHandler");RejoinHandler.prototype.initialize=function(){this.entity.button.on("click",this.rejoin,this)},RejoinHandler.prototype.rejoin=function(){this.app.root.findByName("NetworkManager").script.networkManager.leaveRoom();var e=this.app.scenes.find("Play");this.app.scenes.changeScene(e.url)};var SpectateHandler=pc.createScript("spectateHandler");SpectateHandler.attributes.add("camera",{type:"entity",title:"Camera"}),SpectateHandler.attributes.add("cameraPosition",{type:"vec3",title:"Spectate Camera Position"}),SpectateHandler.prototype.initialize=function(){this.entity.button.on("click",this.spectate,this),this.cameraOffset=this.camera.getPosition().clone()},SpectateHandler.prototype.spectate=function(){this.app.root.findByName("Die Screen").enabled=!1,this.app.root.findByName("Spec Screen").enabled=!0,this.camera.tween(this.camera.getLocalPosition()).to(this.cameraPosition,.5,pc.SineOut).start()};var JoystickController=pc.createScript("joystickController");JoystickController.attributes.add("nub",{type:"entity",title:"Nub"}),JoystickController.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)"}),JoystickController.prototype.initialize=function(){this.forceX=0,this.forceZ=0,this._canVibrate=!!navigator.vibrate,this._setNubState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates.move=void 0)})),this._originalLocalPosition=this.entity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._setButtonState(!1),this._setEvents("on")},JoystickController.prototype._setEvents=function(t){this._state=!1,this._nubState=!1,this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.entity.enabled=!this.hideOnRelease,this.nub.element[t]("mousedown",this._onNubMouseDown,this),this.nub.element[t]("mouseup",this._onNubMouseUp,this),this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.nub.element[t]("touchstart",this._onNubTouchDown,this),this.nub.element[t]("touchend",this._onNubTouchUp,this),this.nub.element[t]("touchcancel",this._onNubTouchUp,this),this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},JoystickController.__uiPos=new pc.Vec2,JoystickController.prototype.screenToUi=function(t){const o=JoystickController.__uiPos,i=this.app.graphicsDevice.canvas.clientWidth,n=this.app.graphicsDevice.canvas.clientHeight;return o.x=t.x/i,o.y=t.y/n,o.mulScalar(2).subScalar(1),o.y*=-1,o},JoystickController.prototype._onNubMouseDown=function(t){console.log("Down"),this._nubState||(this._onPointerDown(),t.stopPropagation()),console.log("Nub Down")},JoystickController.prototype._onNubMouseUp=function(t){this._nubState&&(this._onPointerUp(),t.stopPropagation())},JoystickController.prototype._onNubTouchDown=function(t){this._nubState||(this._onPointerDown(),t.stopPropagation())},JoystickController.prototype._onNubTouchUp=function(t){this._nubState&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},JoystickController.prototype._onNubPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setNubState(!0)},JoystickController.prototype._onNubPointerUp=function(){this._setNubState(!1)},JoystickController.prototype._setNubState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates.move=t?Date.now():null),this._nubState=t},JoystickController.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},JoystickController.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},JoystickController.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},JoystickController.prototype._onTouchDown=function(t){if(this._pointerDown)return;const o=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!o&&this._pointerDown&&t.stopPropagation()},JoystickController.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},JoystickController.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},JoystickController.prototype._onPointerDown=function(t){const o=this.screenToUi(t);this.entity.setPosition(o.x,o.y,0),this.nub.setLocalPosition(0,0,0),this._pointerDown=!0,this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.entity.getLocalPosition()),this.entity.enabled=!0,this._onPointerMove(t))},JoystickController.__tempNubPos=new pc.Vec3,JoystickController.__tempBasePos=new pc.Vec3,JoystickController.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const o=this.screenToUi(t),i=this.axisRange*this.axisRange;this.nub.setPosition(o.x,o.y,0);const n=JoystickController.__tempNubPos;n.copy(this.nub.getLocalPosition());n.lengthSq()>=i&&(n.normalize().mulScalar(this.axisRange),this.nub.setLocalPosition(n)),this._updateAxisValuesFromNub()}},JoystickController.prototype._onPointerUp=function(t){this._pointerDown&&this._pointerId==t.id&&(this.nub.setLocalPosition(0,0,0),this.hideOnRelease&&(this.entity.enabled=!1),this.entity.setLocalPosition(this._originalLocalPosition),this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1)},JoystickController.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,o=this.nub.getLocalPosition(),i=Math.sign(o.x),n=Math.sign(o.y),e=pc.math.clamp(Math.abs(o.x)-this.axisDeadZone,0,t)*i,s=pc.math.clamp(Math.abs(o.y)-this.axisDeadZone,0,t)*n;this._setAxisValues(e/t,s/t)},JoystickController.prototype._setAxisValues=function(t,o){window.touchJoypad&&(window.touchJoypad.sticks.move={x:t,y:o}),this.axisX=t,this.axisY=o},JoystickController.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates.move=t?Date.now():null),this._state=t},JoystickController.prototype.getForce=function(){return{x:this.forceX,y:0,z:this.forceZ}};var ShowAlive=pc.createScript("showAlive");ShowAlive.attributes.add("prefix",{type:"string",title:"Number Prefix"}),ShowAlive.prototype.initialize=function(){this.app.on("alive:change",this.aliveChange,this)},ShowAlive.prototype.aliveChange=function(e){this.entity.element.text=this.prefix+e};